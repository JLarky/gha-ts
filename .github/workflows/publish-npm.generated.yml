# Do not modify!
# This file was generated by https://github.com/JLarky/gha-ts

name: Publish to npm
"on": 
  push: 
    branches: 
      - feat-npm-publish
    tags: 
      - v*
permissions: 
  id-token: write
  contents: read
jobs: 
  publishNpm: 
    name: Publish to npm
    runs-on: ubuntu-latest
    steps: 
      - name: Extract version from tag
        id: version
        run: "VERSION=\"${{ github.ref }}\"\nVERSION=\"${VERSION#refs/tags/v}\"\necho \"version=${VERSION}\" >> \"$GITHUB_OUTPUT\""
      - name: Hello world
        run: "echo \"Hello world! Publishing version ${{ steps.version.outputs.version }}\""
      - name: checkout
        uses: actions/checkout@v5
      - name: Install mise
        uses: jdx/mise-action@v3
      - name: Publish package
        env: 
          NPM_CONFIG_PROVENANCE: "true"
        run: "mise run clone-to-npm --publish --ci -d \"$RUNNER_TEMP\" --skip-publish"
      - run: pwd && ls -la
        working-directory: "${{ runner.temp }}/npm"
      - uses: actions/setup-node@v4
        with: 
          node-version: 22
          registry-url: https://registry.npmjs.org
      - id: publish-package
        continue-on-error: true
        run: "export NPM_CONFIG_PROVENANCE=true\nwhich node && node -v\nwhich npm && npm -v\nnpm publish --provenance"
        working-directory: "${{ runner.temp }}/npm"
      - name: Report published package status to GITHUB_STEP_SUMMARY
        run: "{\n           echo \"### Published package status\";\n           echo;\n           echo \"::error title=Published package status::${{ steps.publish-package.conclusion }}\";\n          } >> \"$GITHUB_STEP_SUMMARY\""
      - uses: actions/upload-artifact@v4
        if: "${{ always() }}"
        with: 
          name: "npm-package-${{ steps.version.outputs.version }}"
          path: "${{ runner.temp }}/npm"
          retention-days: 3
